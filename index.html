<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Fault check</title>
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,700" rel="stylesheet">
  <link rel="stylesheet" href="src/css/app.css">
  <link rel="manifest" href="manifest.json">
  
  
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">    

    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript">
    </script>
    <script type = "text/javascript" language = "javascript">
      var mqtt;
      var reconnectTimeout = 2000;
      var host = "broker.emqx.io";
      var port = 8083;
      var topic = "encuentro_2";
      var lastMsg;

      function onFailure(message) {
          console.log("Connection Attempt to Host "+host+"Failed");
          setTimeout(MQTTconnect, reconnectTimeout);
      }

      function onMessageArrived(msg){
          out_msg = "Message received " + msg.payloadString + "<br>";
          out_msg = out_msg+"Message received Topic " + msg.destinationName;
          console.log(out_msg);
          //document.write(msg.payloadString);
          switch (msg.payloadString) {
            case "1":
              document.body.style.backgroundColor = "aqua";
              break;
            case "2":
              document.body.style.backgroundColor = "red";
              break;
            case "3":
              document.body.style.backgroundColor = "green";
              break;
            case "4":
              document.body.style.backgroundColor = "orange";
              break;
          }
          
          document.getElementById("msgs").innerHTML = document.getElementById("msgs").innerHTML 
            + "Mensaje recibido: " + msg.payloadString + "<br>";
      }

      function onConnect() {
        // Once a connection has been made, make a subscription and send a message.
        console.log("Connected ");
        //document.write("connected to "+ host);
        document.getElementById("connectionStatus").innerHTML = "Connected to " + host;
        mqtt.subscribe(topic);
        message = new Paho.MQTT.Message("Client Connected Sucessfully");
        message.destinationName = topic;
        mqtt.send(message);
      }

      function enviaMsg() {
        if (document.getElementById("msgToSend").value == "") {
          alert("Debes ingresar un mensaje..");
          return;
        } else {
          message = new Paho.MQTT.Message(document.getElementById("msgToSend").value);
          message.destinationName = topic;
          mqtt.send(message);
        }
      }

      function MQTTconnect() {
        console.log("connecting to "+ host +" "+ port);
        //var id = "ID:mqttx_e1210181";
        var id = "ID:mqttx_e" + Math.random() * 9999999;
        alert(id);
        mqtt = new Paho.MQTT.Client(host,port,id);
        //document.write("connecting to "+ host);
        var options = {
            timeout: 3,
            userName : "we_aca_2022",
            password : "Mats&1234_",
            onSuccess: onConnect,
            onFailure: onFailure,
            };
        mqtt.onMessageArrived = onMessageArrived;
        mqtt.connect(options); //connect
      }
  </script>
</head>
<body onload="MQTTconnect();">
<header class="main-header">
  <h1>WeWire</h1>
  <h3>Fault Checker System.</h3>
</header>
<article class="card" id="pwa">
  <div class="card__image">
    <img src="src/images/icon-512x512.png" alt="WeWire" style="height;200px;">
  </div>
  <div class="card__content">
    <p>PWAs are great, since you can build native-mobile-app-like experiences.</p>
          <p style="font-size: 28px;color: rgb(5, 5, 122); margin-top: 70px;">Wewire Interaction with broker</p>
          <p style="font-size: 24px;color: rgb(5, 5, 122); ">Operations</p>
          <p style="font-size: 18px;color: rgb(5, 5, 122);">Ingresa el mensaje: </p>
          <input class="form-control" type="text" placeholder="Mensaje..." id="msgToSend">          
          <input type="button" onclick="enviaMsg();" value="Enviar Mensaje" class="btn btn-success" style="margin-top: 20px;"/>

          <p style="font-size: 24px;color: rgb(5, 5, 122); margin-top: 100px;">Connection Status</p>
          <p style="font-size: 18px;color: rgb(5, 5, 122); " id="connectionStatus"></p>
          <p style="font-size: 16px;color: rgb(5, 5, 122);" id="msgs"></p>
    
  </div>
  
  <div class="card__details">
          <p>--</p>
  </div>
  
  
  
</article>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>   

  
  
</body>
</html>
